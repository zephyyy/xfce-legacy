diff --git a/configure.ac b/configure.ac
index 57f9ae8..d3c378e 100644
--- a/configure.ac
+++ b/configure.ac
@@ -78,17 +78,17 @@ fi
 dnl ***********************************
 dnl *** Check for required packages ***
 dnl ***********************************
-XDT_CHECK_PACKAGE([GTK], [gtk+-3.0], [3.18.0])
+XDT_CHECK_PACKAGE([GTK], [gtk+-2.0], [2.24.0])
 XDT_CHECK_PACKAGE([LIBXFCE4UTIL], [libxfce4util-1.0], [4.12.0])
-XDT_CHECK_PACKAGE([LIBXFCE4UI], [libxfce4ui-2], [4.12.0])
-XDT_CHECK_PACKAGE([LIBXFCE4PANEL], [libxfce4panel-2.0], [4.12.0])
+XDT_CHECK_PACKAGE([LIBXFCE4UI], [libxfce4ui-1], [4.12.0])
+XDT_CHECK_PACKAGE([LIBXFCE4PANEL], [libxfce4panel-1.0], [4.12.0])
 XDT_CHECK_PACKAGE([XFCONF], [libxfconf-0], [4.13.0],,[
         AC_DEFINE([XFCONF_LEGACY], [], [Use dbus-glib provided by xfconf 4.12 to obtain array type])
         XDT_CHECK_PACKAGE([XFCONF], [libxfconf-0], [4.12.0])
 ])
 XDT_CHECK_PACKAGE([GIO], [gio-2.0], [2.24.0])
 PKG_CHECK_MODULES([GIO_UNIX], [gio-unix-2.0 >= 2.24.0])
-XDT_CHECK_PACKAGE([DBUSMENU], [dbusmenu-gtk3-0.4], [16.04.0])
+XDT_CHECK_PACKAGE([DBUSMENU], [dbusmenu-gtk-0.4], [16.04.0])
 
 dnl ***********************************
 dnl *** Check for debugging support ***
diff --git a/panel-plugin/Makefile.am b/panel-plugin/Makefile.am
index 3934f46..9b55cce 100644
--- a/panel-plugin/Makefile.am
+++ b/panel-plugin/Makefile.am
@@ -37,6 +37,8 @@ libstatusnotifier_la_SOURCES = \
 	sn-util.h
 
 libstatusnotifier_la_CFLAGS = \
+	$(GIO_CFLAGS) \
+	$(GIO_UNIX_CFLAGS) \
 	$(GTK_CFLAGS) \
 	$(LIBXFCE4UTIL_CFLAGS) \
 	$(LIBXFCE4UI_CFLAGS) \
@@ -54,6 +56,8 @@ libstatusnotifier_la_LDFLAGS = \
 	$(PLATFORM_LDFLAGS)
 
 libstatusnotifier_la_LIBADD = \
+	$(GIO_LIBS) \
+	$(GIO_UNIX_LIBS) \
 	$(GTK_LIBS) \
 	$(LIBXFCE4UTIL_LIBS) \
 	$(LIBXFCE4UI_LIBS) \
diff --git a/panel-plugin/sn-box.c b/panel-plugin/sn-box.c
index da2eac7..19f1b33 100644
--- a/panel-plugin/sn-box.c
+++ b/panel-plugin/sn-box.c
@@ -55,13 +55,8 @@ static void                  sn_box_forall                           (GtkContain
 
 static GType                 sn_box_child_type                       (GtkContainer            *container);
 
-static void                  sn_box_get_preferred_width              (GtkWidget               *widget,
-                                                                      gint                    *minimal_width,
-                                                                      gint                    *natural_width);
-
-static void                  sn_box_get_preferred_height             (GtkWidget               *widget,
-                                                                      gint                    *minimal_height,
-                                                                      gint                    *natural_height);
+static void                  sn_box_size_request                     (GtkWidget               *widget,
+                                                                      GtkRequisition          *requisition);
 
 static void                  sn_box_size_allocate                    (GtkWidget               *widget,
                                                                      GtkAllocation            *allocation);
@@ -98,8 +93,7 @@ sn_box_class_init (SnBoxClass *klass)
   object_class->finalize = sn_box_finalize;
 
   widget_class = GTK_WIDGET_CLASS (klass);
-  widget_class->get_preferred_width = sn_box_get_preferred_width;
-  widget_class->get_preferred_height = sn_box_get_preferred_height;
+  widget_class->size_request = sn_box_size_request;
   widget_class->size_allocate = sn_box_size_allocate;
 
   container_class = GTK_CONTAINER_CLASS (klass);
@@ -293,10 +287,8 @@ sn_box_child_type (GtkContainer *container)
 
 
 
-static void
+static gint
 sn_box_measure_and_allocate (GtkWidget *widget,
-                             gint      *minimum_length,
-                             gint      *natural_length,
                              gboolean   allocate,
                              gint       x0,
                              gint       y0,
@@ -347,7 +339,7 @@ sn_box_measure_and_allocate (GtkWidget *widget,
               continue;
             }
 
-          gtk_widget_get_preferred_size (GTK_WIDGET (button), NULL, &child_req);
+          gtk_widget_size_request (GTK_WIDGET (button), &child_req);
 
           rect_child = child_req.width > child_req.height;
           if (horizontal)
@@ -409,66 +401,31 @@ sn_box_measure_and_allocate (GtkWidget *widget,
     }
 
   total_length += column_length;
-
-  if (minimum_length != NULL)
-    *minimum_length = total_length;
-
-  if (natural_length != NULL)
-    *natural_length = total_length;
+  return total_length;
 }
 
 
 
 static void
-sn_box_get_preferred_width (GtkWidget *widget,
-                            gint      *minimum_width,
-                            gint      *natural_width)
+sn_box_size_request (GtkWidget      *widget,
+                     GtkRequisition *requisition)
 {
   SnBox *box = XFCE_SN_BOX (widget);
-  gint   panel_size;
+  gint   panel_size = sn_config_get_panel_size (box->config);
 
   if (sn_config_get_panel_orientation (box->config) == GTK_ORIENTATION_HORIZONTAL)
     {
-      sn_box_measure_and_allocate (widget, minimum_width, natural_width,
-                                   FALSE, 0, 0, TRUE);
-    }
-  else
-    {
-      panel_size = sn_config_get_panel_size (box->config);
-      if (minimum_width != NULL)
-        *minimum_width = panel_size;
-      if (natural_width != NULL)
-        *natural_width = panel_size;
-    }
-}
-
-
-
-static void
-sn_box_get_preferred_height (GtkWidget *widget,
-                             gint      *minimum_height,
-                             gint      *natural_height)
-{
-  SnBox *box = XFCE_SN_BOX (widget);
-  gint   panel_size;
-
-  if (sn_config_get_panel_orientation (box->config) == GTK_ORIENTATION_VERTICAL)
-    {
-      sn_box_measure_and_allocate (widget, minimum_height, natural_height,
-                                   FALSE, 0, 0, FALSE);
+      requisition->width = sn_box_measure_and_allocate (widget, FALSE, 0, 0, TRUE);
+      requisition->height = panel_size;
     }
   else
     {
-      panel_size = sn_config_get_panel_size (box->config);
-      if (minimum_height != NULL)
-        *minimum_height = panel_size;
-      if (natural_height != NULL)
-        *natural_height = panel_size;
+      requisition->height = sn_box_measure_and_allocate (widget, FALSE, 0, 0, FALSE);
+      requisition->width = panel_size;
     }
 }
 
 
-
 static void
 sn_box_size_allocate (GtkWidget     *widget,
                       GtkAllocation *allocation)
@@ -477,8 +434,7 @@ sn_box_size_allocate (GtkWidget     *widget,
 
   gtk_widget_set_allocation (widget, allocation);
 
-  sn_box_measure_and_allocate (widget, NULL, NULL,
-                               TRUE, allocation->x, allocation->y,
+  sn_box_measure_and_allocate (widget, TRUE, allocation->x, allocation->y,
                                sn_config_get_panel_orientation (box->config) ==
                                GTK_ORIENTATION_HORIZONTAL);
 }
diff --git a/panel-plugin/sn-button.c b/panel-plugin/sn-button.c
index de1a120..151ce95 100644
--- a/panel-plugin/sn-button.c
+++ b/panel-plugin/sn-button.c
@@ -43,6 +43,8 @@ static gboolean              sn_button_button_release                (GtkWidget
 static gboolean              sn_button_scroll_event                  (GtkWidget               *widget,
                                                                       GdkEventScroll          *event);
 
+static void                  sn_button_clicked                       (GtkButton               *widget);
+
 static void                  sn_button_menu_changed                  (GtkWidget               *widget,
                                                                       SnItem                  *item);
 
@@ -57,12 +59,12 @@ static gboolean              sn_button_query_tooltip                 (GtkWidget
 
 struct _SnButtonClass
 {
-  GtkButtonClass       __parent__;
+  GtkToggleButtonClass __parent__;
 };
 
 struct _SnButton
 {
-  GtkButton            __parent__;
+  GtkToggleButton      __parent__;
 
   SnItem              *item;
   SnConfig            *config;
@@ -72,6 +74,7 @@ struct _SnButton
 
   GtkWidget           *menu;
   gboolean             menu_only;
+  gboolean             menu_active;
 
   GtkWidget           *box;
 
@@ -80,7 +83,7 @@ struct _SnButton
   guint                menu_size_allocate_idle_handler;
 };
 
-G_DEFINE_TYPE (SnButton, sn_button, GTK_TYPE_BUTTON)
+G_DEFINE_TYPE (SnButton, sn_button, GTK_TYPE_TOGGLE_BUTTON)
 
 
 
@@ -89,6 +92,7 @@ sn_button_class_init (SnButtonClass *klass)
 {
   GObjectClass   *object_class;
   GtkWidgetClass *widget_class;
+  GtkButtonClass *button_class;
 
   object_class = G_OBJECT_CLASS (klass);
   object_class->finalize = sn_button_finalize;
@@ -97,6 +101,9 @@ sn_button_class_init (SnButtonClass *klass)
   widget_class->button_press_event = sn_button_button_press;
   widget_class->button_release_event = sn_button_button_release;
   widget_class->scroll_event = sn_button_scroll_event;
+
+  button_class = GTK_BUTTON_CLASS (klass);
+  button_class->clicked = sn_button_clicked;
 }
 
 
@@ -104,23 +111,11 @@ sn_button_class_init (SnButtonClass *klass)
 static void
 sn_button_init (SnButton *button)
 {
-  GtkCssProvider *css_provider;
-
   gtk_button_set_relief (GTK_BUTTON (button), GTK_RELIEF_NONE);
 
   gtk_widget_set_name (GTK_WIDGET (button), "sn-button");
-  css_provider = gtk_css_provider_new ();
-  gtk_css_provider_load_from_data (css_provider,
-                                   "#sn-button {"
-                                     "padding: 0px;"
-                                     "border-width: 1px;"
-                                   "}", -1, NULL);
-  gtk_style_context_add_provider (GTK_STYLE_CONTEXT (gtk_widget_get_style_context (GTK_WIDGET (button))),
-                                  GTK_STYLE_PROVIDER (css_provider),
-                                  GTK_STYLE_PROVIDER_PRIORITY_APPLICATION);
-  g_object_unref (css_provider);
-
-  gtk_widget_add_events (GTK_WIDGET (button), GDK_SCROLL_MASK | GDK_SMOOTH_SCROLL_MASK);
+
+  gtk_widget_add_events (GTK_WIDGET (button), GDK_SCROLL_MASK);
 
   button->item = NULL;
   button->config = NULL;
@@ -136,9 +131,6 @@ sn_button_init (SnButton *button)
   button->menu_deactivate_handler = 0;
   button->menu_size_allocate_handler = 0;
   button->menu_size_allocate_idle_handler = 0;
-
-  gtk_widget_set_halign (GTK_WIDGET (button), GTK_ALIGN_FILL);
-  gtk_widget_set_valign (GTK_WIDGET (button), GTK_ALIGN_FILL);
 }
 
 
@@ -229,7 +221,8 @@ sn_button_menu_deactivate (GtkWidget *widget,
     button->menu_deactivate_handler = 0;
   }
 
-  gtk_widget_unset_state_flags (widget, GTK_STATE_FLAG_ACTIVE);
+  button->menu_active = FALSE;
+  gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (widget), FALSE);
 }
 
 
@@ -273,7 +266,8 @@ sn_button_button_press (GtkWidget      *widget,
                           event->button, event->time);
 #endif
 
-          gtk_widget_set_state_flags (widget, GTK_STATE_FLAG_ACTIVE, FALSE);
+          button->menu_active = TRUE;
+          gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (widget), TRUE);
           return TRUE;
         }
       else if (event->button == 3)
@@ -327,21 +321,22 @@ sn_button_scroll_event (GtkWidget      *widget,
                         GdkEventScroll *event)
 {
   SnButton *button = XFCE_SN_BUTTON (widget);
-  gdouble   delta_x, delta_y;
+  gint      delta  = 10;
 
-  if (!gdk_event_get_scroll_deltas ((GdkEvent *)event, &delta_x, &delta_y))
+  switch (event->direction)
     {
-      delta_x = event->delta_x;
-      delta_y = event->delta_y;
-    }
-
-  if (delta_x != 0 || delta_y != 0)
-    {
-      delta_x = (delta_x == 0 ? 0 : delta_x > 0 ? 1 : -1) *
-                MAX (ABS (delta_x) + 0.5, 1);
-      delta_y = (delta_y == 0 ? 0 : delta_y > 0 ? 1 : -1) *
-                MAX (ABS (delta_y) + 0.5, 1);
-      sn_item_scroll (button->item, (gint) delta_x, (gint) delta_y);
+    case GDK_SCROLL_UP:
+      sn_item_scroll (button->item, 0, -delta);
+      break;
+    case GDK_SCROLL_DOWN:
+      sn_item_scroll (button->item, 0, delta);
+      break;
+    case GDK_SCROLL_LEFT:
+      sn_item_scroll (button->item, -delta, 0);
+      break;
+    case GDK_SCROLL_RIGHT:
+      sn_item_scroll (button->item, delta, 0);
+      break;
     }
 
   return TRUE;
@@ -349,6 +344,20 @@ sn_button_scroll_event (GtkWidget      *widget,
 
 
 
+static void
+sn_button_clicked (GtkButton *widget)
+{
+  SnButton *button = XFCE_SN_BUTTON (widget);
+
+  /* process state change */
+  GTK_BUTTON_CLASS (sn_button_parent_class)->clicked (widget);
+
+  if (!button->menu_active)
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (widget), FALSE);
+}
+
+
+
 static gboolean
 sn_button_menu_size_changed_idle (gpointer user_data)
 {
@@ -390,7 +399,8 @@ sn_button_menu_changed (GtkWidget *widget,
           g_signal_handler_disconnect (button->menu, button->menu_deactivate_handler);
           button->menu_deactivate_handler = 0;
 
-          gtk_widget_unset_state_flags (widget, GTK_STATE_FLAG_ACTIVE);
+          button->menu_active = FALSE;
+          gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (widget), FALSE);
           gtk_menu_popdown (GTK_MENU (button->menu));
         }
 
diff --git a/panel-plugin/sn-dialog.glade b/panel-plugin/sn-dialog.glade
index 2077c7c..e6db84c 100644
--- a/panel-plugin/sn-dialog.glade
+++ b/panel-plugin/sn-dialog.glade
@@ -1,8 +1,8 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!-- Generated with glade 3.22.1 -->
 <interface>
-  <requires lib="gtk+" version="3.18"/>
-  <requires lib="libxfce4ui-2" version="4.12"/>
+  <requires lib="gtk+" version="2.24"/>
+  <requires lib="libxfce4ui-1" version="4.12"/>
   <object class="GtkImage" id="image1">
     <property name="visible">True</property>
     <property name="can_focus">False</property>
@@ -30,18 +30,17 @@
   <object class="XfceTitledDialog" id="dialog">
     <property name="can_focus">False</property>
     <property name="title" translatable="yes">Status Notifier Items</property>
-    <property name="default_width">425</property>
-    <property name="default_height">575</property>
+    <property name="default_width">400</property>
+    <property name="default_height">540</property>
     <property name="icon_name">gtk-properties</property>
     <property name="type_hint">normal</property>
     <child internal-child="vbox">
-      <object class="GtkBox" id="dialog-vbox2">
+      <object class="GtkVBox" id="dialog-vbox2">
         <property name="visible">True</property>
         <property name="can_focus">False</property>
-        <property name="orientation">vertical</property>
         <property name="spacing">2</property>
         <child internal-child="action_area">
-          <object class="GtkButtonBox" id="dialog-action_area2">
+          <object class="GtkHButtonBox" id="dialog-action_area2">
             <property name="visible">True</property>
             <property name="can_focus">False</property>
             <property name="layout_style">end</property>
@@ -68,12 +67,11 @@
           </packing>
         </child>
         <child>
-          <object class="GtkBox" id="vbox1">
+          <object class="GtkVBox" id="vbox1">
             <property name="visible">True</property>
             <property name="can_focus">False</property>
-            <property name="border_width">12</property>
-            <property name="orientation">vertical</property>
-            <property name="spacing">18</property>
+            <property name="border_width">6</property>
+            <property name="spacing">12</property>
             <child>
               <object class="GtkFrame" id="frame2">
                 <property name="visible">True</property>
@@ -87,13 +85,12 @@
                     <property name="top_padding">6</property>
                     <property name="left_padding">12</property>
                     <child>
-                      <object class="GtkBox" id="vbox2">
+                      <object class="GtkVBox" id="vbox2">
                         <property name="visible">True</property>
                         <property name="can_focus">False</property>
-                        <property name="orientation">vertical</property>
                         <property name="spacing">6</property>
                         <child>
-                          <object class="GtkBox" id="hbox1">
+                          <object class="GtkHBox" id="hbox1">
                             <property name="visible">True</property>
                             <property name="can_focus">False</property>
                             <property name="spacing">12</property>
@@ -211,10 +208,9 @@
                     <property name="top_padding">6</property>
                     <property name="left_padding">12</property>
                     <child>
-                      <object class="GtkBox" id="vbox3">
+                      <object class="GtkVBox" id="vbox3">
                         <property name="visible">True</property>
                         <property name="can_focus">False</property>
-                        <property name="orientation">vertical</property>
                         <property name="spacing">6</property>
                         <child>
                           <object class="GtkCheckButton" id="checkbutton-menu-is-primary">
@@ -265,10 +261,9 @@
                     <property name="top_padding">6</property>
                     <property name="left_padding">12</property>
                     <child>
-                      <object class="GtkBox" id="vbox4">
+                      <object class="GtkVBox" id="vbox4">
                         <property name="visible">True</property>
                         <property name="can_focus">False</property>
-                        <property name="orientation">vertical</property>
                         <property name="spacing">6</property>
                         <child>
                           <object class="GtkCheckButton" id="checkbutton-whitelist">
@@ -286,7 +281,7 @@
                           </packing>
                         </child>
                         <child>
-                          <object class="GtkBox" id="hbox2">
+                          <object class="GtkHBox" id="hbox2">
                             <property name="visible">True</property>
                             <property name="can_focus">False</property>
                             <property name="spacing">6</property>
@@ -305,7 +300,7 @@
                                     <property name="rules_hint">True</property>
                                     <property name="enable_search">False</property>
                                     <child internal-child="selection">
-                                      <object class="GtkTreeSelection"/>
+                                      <object class="GtkTreeSelection" id="items-treeview-selection"/>
                                     </child>
                                     <child>
                                       <object class="GtkTreeViewColumn" id="treeviewcolumn-icon">
@@ -351,10 +346,9 @@
                               </packing>
                             </child>
                             <child>
-                              <object class="GtkBox" id="vbox5">
+                              <object class="GtkVBox" id="vbox5">
                                 <property name="visible">True</property>
                                 <property name="can_focus">False</property>
-                                <property name="orientation">vertical</property>
                                 <property name="spacing">6</property>
                                 <child>
                                   <object class="GtkButton" id="item-up">
@@ -411,7 +405,7 @@
                           </packing>
                         </child>
                         <child>
-                          <object class="GtkButtonBox" id="hbuttonbox1">
+                          <object class="GtkHButtonBox" id="hbuttonbox1">
                             <property name="visible">True</property>
                             <property name="can_focus">False</property>
                             <property name="layout_style">start</property>
diff --git a/panel-plugin/sn-icon-box.c b/panel-plugin/sn-icon-box.c
index 85670f6..c7bc752 100644
--- a/panel-plugin/sn-icon-box.c
+++ b/panel-plugin/sn-icon-box.c
@@ -34,13 +34,8 @@
 
 static void                  sn_icon_box_icon_changed                (GtkWidget               *widget);
 
-static void                  sn_icon_box_get_preferred_width         (GtkWidget               *widget,
-                                                                      gint                    *minimum_width,
-                                                                      gint                    *natural_width);
-
-static void                  sn_icon_box_get_preferred_height        (GtkWidget               *widget,
-                                                                      gint                    *minimum_height,
-                                                                      gint                    *natural_height);
+static void                  sn_icon_box_size_request                (GtkWidget               *widget,
+                                                                      GtkRequisition          *requisition);
 
 static void                  sn_icon_box_size_allocate               (GtkWidget               *widget,
                                                                       GtkAllocation           *allocation);
@@ -83,8 +78,7 @@ sn_icon_box_class_init (SnIconBoxClass *klass)
   GtkContainerClass *container_class;
 
   widget_class = GTK_WIDGET_CLASS (klass);
-  widget_class->get_preferred_width = sn_icon_box_get_preferred_width;
-  widget_class->get_preferred_height = sn_icon_box_get_preferred_height;
+  widget_class->size_request = sn_icon_box_size_request;
   widget_class->size_allocate = sn_icon_box_size_allocate;
 
   container_class = GTK_CONTAINER_CLASS (klass);
@@ -295,16 +289,8 @@ sn_icon_box_apply_icon (GtkWidget    *image,
                                                       0);
               if (icon_info != NULL)
                 {
-                  if (gtk_icon_info_is_symbolic (icon_info))
-                    {
-                      use_symbolic = TRUE;
-                      max_size = symbolic_icon_size;
-                    }
-                  else
-                    {
-                      g_object_unref (icon_info);
-                      icon_info = NULL;
-                    }
+                  use_symbolic = TRUE;
+                  max_size = symbolic_icon_size;
                 }
             }
 
@@ -322,7 +308,7 @@ sn_icon_box_apply_icon (GtkWidget    *image,
                                             ? symbolic_icon_name
                                             : sn_preferred_name (),
                                             GTK_ICON_SIZE_BUTTON);
-              g_object_unref (icon_info);
+              gtk_icon_info_free (icon_info);
               use_pixbuf = FALSE;
             }
         }
@@ -416,10 +402,8 @@ sn_icon_box_icon_changed (GtkWidget *widget)
 
 
 static void
-sn_icon_box_get_preferred_size (GtkWidget *widget,
-                                gint      *minimum_size,
-                                gint      *natural_size,
-                                gboolean   horizontal)
+sn_icon_box_size_request (GtkWidget      *widget,
+                          GtkRequisition *requisition)
 {
   SnIconBox      *box = XFCE_SN_ICON_BOX (widget);
   gint            icon_size;
@@ -428,8 +412,10 @@ sn_icon_box_get_preferred_size (GtkWidget *widget,
 
   icon_size = sn_config_get_icon_size (box->config);
 
-  pixbuf1 = gtk_image_get_pixbuf (GTK_IMAGE (box->icon));
-  pixbuf2 = gtk_image_get_pixbuf (GTK_IMAGE (box->overlay));
+  pixbuf1 = gtk_image_get_storage_type (GTK_IMAGE (box->icon)) == GTK_IMAGE_PIXBUF
+          ? gtk_image_get_pixbuf (GTK_IMAGE (box->icon)) : NULL;
+  pixbuf2 = gtk_image_get_storage_type (GTK_IMAGE (box->overlay)) == GTK_IMAGE_PIXBUF
+          ? gtk_image_get_pixbuf (GTK_IMAGE (box->overlay)) : NULL;
   if (pixbuf2 != NULL && (pixbuf1 == NULL ||
       gdk_pixbuf_get_width (pixbuf2) > gdk_pixbuf_get_width (pixbuf1) ||
       gdk_pixbuf_get_height (pixbuf2) > gdk_pixbuf_get_height (pixbuf1)))
@@ -438,46 +424,23 @@ sn_icon_box_get_preferred_size (GtkWidget *widget,
     }
 
   if (box->icon != NULL)
-    gtk_widget_get_preferred_size (box->icon, NULL, &child_req);
+    gtk_widget_size_request (box->icon, &child_req);
 
   if (box->overlay != NULL)
-    gtk_widget_get_preferred_size (box->overlay, NULL, &child_req);
-
-  if (minimum_size != NULL)
-    *minimum_size = icon_size;
+    gtk_widget_size_request (box->overlay, &child_req);
 
-  if (natural_size != NULL)
+  if (pixbuf1 != NULL)
     {
-      *natural_size = 0;
-      if (pixbuf1 != NULL)
-        {
-          if (horizontal)
-            *natural_size = gdk_pixbuf_get_width (pixbuf1);
-          else
-            *natural_size = gdk_pixbuf_get_height (pixbuf1);
-        }
-      *natural_size = MAX (*natural_size, icon_size);
+      requisition->width = gdk_pixbuf_get_width (pixbuf1);
+      requisition->height = gdk_pixbuf_get_height (pixbuf1);
+      requisition->width = MAX (requisition->width, icon_size);
+      requisition->height = MAX (requisition->height, icon_size);
+    }
+  else
+    {
+      requisition->width = 0;
+      requisition->height = 0;
     }
-}
-
-
-
-static void
-sn_icon_box_get_preferred_width (GtkWidget *widget,
-                                 gint      *minimum_width,
-                                 gint      *natural_width)
-{
-  sn_icon_box_get_preferred_size (widget, minimum_width, natural_width, TRUE);
-}
-
-
-
-static void
-sn_icon_box_get_preferred_height (GtkWidget *widget,
-                                  gint      *minimum_height,
-                                  gint      *natural_height)
-{
-  sn_icon_box_get_preferred_size (widget, minimum_height, natural_height, FALSE);
 }
 
 
diff --git a/panel-plugin/statusnotifier.desktop.in b/panel-plugin/statusnotifier.desktop.in
index 4557d7d..92149c5 100644
--- a/panel-plugin/statusnotifier.desktop.in
+++ b/panel-plugin/statusnotifier.desktop.in
@@ -7,4 +7,4 @@ Icon=xfce4-statusnotifier-plugin
 X-XFCE-Module=statusnotifier
 X-XFCE-Unique=FALSE
 X-XFCE-Internal=FALSE
-X-XFCE-API=2.0
+X-XFCE-API=1.0
