From 404c1069ae561bd716eb4f9ff7758df6c3057574 Mon Sep 17 00:00:00 2001
From: Andre Miranda <andre42m@gmail.com>
Date: Fri, 4 May 2018 00:12:32 -0300
Subject: [PATCH 3/6] Prefer sysfs to Intel pstate in cpufreq_linux_init (Bug
 #13835)

---
 panel-plugin/xfce4-cpufreq-linux.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/panel-plugin/xfce4-cpufreq-linux.c b/panel-plugin/xfce4-cpufreq-linux.c
index ed61707..1dc0dc4 100644
--- a/panel-plugin/xfce4-cpufreq-linux.c
+++ b/panel-plugin/xfce4-cpufreq-linux.c
@@ -437,7 +437,10 @@ cpufreq_linux_init (void)
 	if (cpuFreq->cpus == NULL)
 		return FALSE;
 
-	if (g_file_test ("/sys/devices/system/cpu/intel_pstate", G_FILE_TEST_EXISTS)) {
+	if (g_file_test ("/sys/devices/system/cpu/cpu0/cpufreq", G_FILE_TEST_EXISTS))
+		return cpufreq_cpu_read_sysfs ();
+	else if (g_file_test ("/sys/devices/system/cpu/intel_pstate", G_FILE_TEST_EXISTS))
+	{
 		gboolean ret = cpufreq_cpu_intel_pstate_read ();
 
 		/* Tools like i7z show the current real frequency using the
@@ -452,9 +455,7 @@ cpufreq_linux_init (void)
 			cpuFreq->options->show_warning = FALSE;
 		}
 		return ret;
-	} else if (g_file_test ("/sys/devices/system/cpu/cpu0/cpufreq",
-						  G_FILE_TEST_EXISTS))
-		return cpufreq_cpu_read_sysfs ();
+	}
 	else if (g_file_test ("/proc/cpufreq", G_FILE_TEST_EXISTS))
 		return cpufreq_cpu_read_procfs ();
 	else
-- 
2.45.2

